define("tiny_cursive/analytic_events",["exports","./analytic_modal","core/ajax","core/str","core/chartjs"],(function(_exports,_analytic_modal,_ajax,Str,_chartjs){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module analytic_events
   *
   * @module     tiny_cursive/analytic_events
   * @copyright  2024 CTI <your@email.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_analytic_modal=_interopRequireDefault(_analytic_modal),Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str),_chartjs=_interopRequireDefault(_chartjs);return _exports.default=class{createModal(userid,context){let questionid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",authIcon=arguments.length>3?arguments[3]:void 0;const element=document.getElementById("analytics"+userid+questionid);element&&element.addEventListener("click",(function(e){e.preventDefault(),_analytic_modal.default.create({templateContext:context}).then((modal=>{const content=document.querySelector("#content"+userid+" .table tbody tr:first-child td:nth-child(2)");content&&(content.innerHTML=authIcon),modal.show()})).catch((error=>{console.error("Failed to create modal:",error)}))}))}analytics(userid,templates,context){let questionid=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",replayInstances=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,authIcon=arguments.length>5?arguments[5]:void 0;document.body.addEventListener("click",(function(e){if(e.target&&e.target.id==="analytic"+userid+questionid){const repElement=document.getElementById("rep"+userid+questionid);repElement&&(repElement.disabled=!1),e.preventDefault();const content=document.getElementById("content"+userid);if(content){content.innerHTML="";const loaderDiv=document.createElement("div");loaderDiv.className="d-flex justify-content-center my-5";const loader=document.createElement("div");loader.className="tiny_cursive-loader",loaderDiv.appendChild(loader),content.appendChild(loaderDiv)}replayInstances&&replayInstances[userid]&&replayInstances[userid].stopReplay(),document.querySelectorAll(".tiny_cursive-nav-tab .active").forEach((el=>el.classList.remove("active"))),e.target.classList.add("active"),templates.render("tiny_cursive/analytics_table",context).then((function(html){const content=document.getElementById("content"+userid);content&&(content.innerHTML=html);const firstCell=document.querySelector("#content"+userid+" .table tbody tr:first-child td:nth-child(2)");firstCell&&(firstCell.innerHTML=authIcon)})).catch((function(error){console.error("Failed to render template:",error)}))}}))}checkDiff(userid,fileid){let questionid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",replayInstances=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const nodata=document.createElement("p");nodata.className="text-center p-5 bg-light rounded m-5 text-primary",nodata.style.verticalAlign="middle",nodata.style.textTransform="uppercase",nodata.style.fontWeight="500",nodata.textContent="no data received yet",document.body.addEventListener("click",(function(e){if(e.target&&e.target.id==="diff"+userid+questionid){const repElement=document.getElementById("rep"+userid+questionid);repElement&&(repElement.disabled=!1),e.preventDefault();const content=document.getElementById("content"+userid);if(content){content.innerHTML="";const loaderDiv=document.createElement("div");loaderDiv.className="d-flex justify-content-center my-5";const loader=document.createElement("div");loader.className="tiny_cursive-loader",loaderDiv.appendChild(loader),content.appendChild(loaderDiv)}if(document.querySelectorAll(".tiny_cursive-nav-tab .active").forEach((el=>el.classList.remove("active"))),e.target.classList.add("active"),replayInstances&&replayInstances[userid]&&replayInstances[userid].stopReplay(),!fileid){const content=document.getElementById("content"+userid);throw content&&(content.innerHTML=nodata.outerHTML),new Error("Missing file id or Difference Content not received yet")}(0,_ajax.call)([{methodname:"cursive_get_writing_differences",args:{fileid:fileid}}])[0].done((response=>{let responsedata=JSON.parse(response.data);if(responsedata[0]){let submitted_text=atob(responsedata[0].submitted_text);Str.get_strings([{key:"original_text",component:"tiny_cursive"},{key:"editspastesai",component:"tiny_cursive"}]).done((strings=>{const originalTextString=strings[0],editsPastesAIString=strings[1],legend=document.createElement("div");legend.className="d-flex p-2 border rounded mb-2";const attributedItem=document.createElement("div");attributedItem.className="tiny_cursive-legend-item";const attributedBox=document.createElement("div");attributedBox.className="tiny_cursive-box attributed";const attributedText=document.createElement("span");attributedText.textContent=originalTextString,attributedItem.appendChild(attributedBox),attributedItem.appendChild(attributedText);const unattributedItem=document.createElement("div");unattributedItem.className="tiny_cursive-legend-item";const unattributedBox=document.createElement("div");unattributedBox.className="tiny_cursive-box tiny_cursive_added";const unattributedText=document.createElement("span");unattributedText.textContent=editsPastesAIString,unattributedItem.appendChild(unattributedBox),unattributedItem.appendChild(unattributedText),legend.appendChild(attributedItem),legend.appendChild(unattributedItem);let contents=document.createElement("div");contents.className="tiny_cursive-comparison-content";let textBlock2=document.createElement("div");textBlock2.className="tiny_cursive-text-block",textBlock2.innerHTML='<div id="tiny_cursive-reconstructed_text">'.concat(JSON.parse(submitted_text),"</div>"),contents.appendChild(legend),contents.appendChild(textBlock2);const content=document.getElementById("content"+userid);content&&(content.innerHTML=contents.outerHTML)})).catch((error=>{console.error("Failed to load language strings:",error);const content=document.getElementById("content"+userid);content&&(content.innerHTML=nodata.outerHTML)}))}else{const content=document.getElementById("content"+userid);content&&(content.innerHTML=nodata.outerHTML)}})).catch((error=>{const content=document.getElementById("content"+userid);throw content&&(content.innerHTML=nodata.outerHTML),new Error("Error loading JSON file: "+error.message)}))}}))}replyWriting(userid,filepath){let questionid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",replayInstances=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;document.body.addEventListener("click",(function(e){if(e.target&&e.target.id==="rep"+userid+questionid){e.target.disabled=!0,e.preventDefault();const content=document.getElementById("content"+userid);if(content){content.innerHTML="";const loaderDiv=document.createElement("div");loaderDiv.className="d-flex justify-content-center my-5";const loader=document.createElement("div");loader.className="tiny_cursive-loader",loaderDiv.appendChild(loader),content.appendChild(loaderDiv)}document.querySelectorAll(".tiny_cursive-nav-tab .active").forEach((el=>el.classList.remove("active"))),e.target.classList.add("active"),replayInstances&&replayInstances[userid]&&replayInstances[userid].stopReplay(),questionid?video_playback(userid,filepath,questionid):video_playback(userid,filepath)}}))}quality(userid,templates,context){let questionid=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",replayInstances=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;document.body.addEventListener("click",(function(e){if(e.target&&e.target.id==="quality"+userid+questionid){const repElement=document.getElementById("rep"+userid+questionid);repElement&&(repElement.disabled=!1),e.preventDefault();const content=document.getElementById("content"+userid);if(content){content.innerHTML="";const loaderDiv=document.createElement("div");loaderDiv.className="d-flex justify-content-center my-5";const loader=document.createElement("div");loader.className="tiny_cursive-loader",loaderDiv.appendChild(loader),content.appendChild(loaderDiv)}replayInstances&&replayInstances[userid]&&replayInstances[userid].stopReplay(),templates.render("tiny_cursive/quality_cart",context).then((function(html){const content=document.getElementById("content"+userid);content&&(content.innerHTML=html);let chartvas=document.querySelector("#chart"+userid);new _chartjs.default(chartvas,{type:"bar",data:{labels:["Average Word Length","Edits","P-burst Count","P-burst Mean","Q Count","Sentence Count","Total Active Time","Verbosity","Word Count","Word Count per Sentence Mean"],datasets:[{data:[25,25,25,-12,45,15,100,23,23,-23],backgroundColor:function(context){const value=context.raw;return value>0&&value<100?"#43BB97":value<0?"#AAAAAA":"#00432F"}}]},options:{indexAxis:"y",elements:{bar:{borderRadius:16,borderWidth:0}},responsive:!0,scales:{x:{beginAtZero:!0,min:-100,max:100,ticks:{callback:function(value){return-100===value||100===value?value+"%":0===value?"Average":""},display:!0,font:function(context){return context&&context.tick&&0===context.tick.value?{weight:"bold",size:14,color:"black"}:{style:"semi-bold",size:13,color:"black"}}},grid:{display:!0,color:function(context){return 0===context.tick.value?"black":"#eaeaea"},lineWidth:function(context){return 0===context.tick.value?2:1},tickLength:0},position:"top"},y:{beginAtZero:!0,ticks:{display:!0,align:"center",crossAlign:"far",font:{size:18},tickLength:100,color:"black"},grid:{display:!0,tickLength:1e3}}},plugins:{legend:{display:!1},title:{display:!1}}},plugins:[{id:"chartAreaBg",beforeDraw:chart=>{const{ctx:ctx,scales:{x:x,y:y}}=chart;ctx.save();const segmentPixel=y.getPixelForValue(y.ticks[0].value)-y.getPixelForValue(y.ticks[1].value),doubleSegment=y.ticks[2].value-y.ticks[0].value;let tickArray=[];for(let i=0;i<=y.max;i+=doubleSegment)i!==y.max&&tickArray.push(i);tickArray.forEach((tick=>{ctx.fillStyle="rgba(0, 0, 0, 0.02)",ctx.fillRect(0,y.getPixelForValue(tick)+52,x.width+x.width+21,segmentPixel)}));chart.data.datasets[0]}}]})})).catch((function(error){console.error("Failed to render template:",error)})),document.querySelectorAll(".tiny_cursive-nav-tab .active").forEach((el=>el.classList.remove("active"))),e.target.classList.add("active")}}))}formatedTime(data){if(data.total_time_seconds){let total_time_seconds=data.total_time_seconds,hours=Math.floor(total_time_seconds/3600).toString().padStart(2,0),minutes=Math.floor(total_time_seconds%3600/60).toString().padStart(2,0),seconds=(total_time_seconds%60).toString().padStart(2,0);return"".concat(hours,"h ").concat(minutes,"m ").concat(seconds,"s")}return"0h 0m 0s"}authorshipStatus(firstFile,score,score_setting){var icon="fa fa-circle-o",color="font-size:32px;color:black";score=parseFloat(score);firstFile?(icon="fa fa-solid fa-info-circle",color="font-size:32px;color:#000000"):score>=score_setting?(icon="fa fa-check-circle",color="font-size:32px;color:green"):score<score_setting&&(icon="fa fa-question-circle",color="font-size:32px;color:#A9A9A9");const iconElement=document.createElement("i");return iconElement.className=icon,iconElement.style=color,iconElement}},_exports.default}));

//# sourceMappingURL=analytic_events.min.js.map