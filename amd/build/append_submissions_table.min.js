define("tiny_cursive/append_submissions_table",["jquery","core/ajax","core/str","core/templates","./replay","./analytic_modal","./analytic_button"],(function($,AJAX,str,templates,Replay,MyModal,analyticButton){const replayInstances={};window.myFunction=function(){let mid=$(this).data("id");$("#typeid"+mid).show()},window.video_playback=function(mid,filepath){if(""!==filepath){const replay=new Replay(elementId="content"+mid,filePath=filepath,speed=10,loop=!1,controllerId="player_"+mid);replayInstances[mid]=replay}else alert("No submission");return!1},window.popup_item=function(mid){$("#"+mid).show()};var usersTable={init:function(score_setting,showcomment){str.get_strings([{key:"confidence_threshold",component:"tiny_cursive"}]).done((function(){usersTable.appendTable(score_setting,showcomment)}))},appendTable:function(score_setting){let sub_url=window.location.href,parm=new URL(sub_url),h_tr=$("thead").find("tr").get()[0];$(h_tr).find("th").eq(3).after('<th class="header c3 email">TypeID</th><th class="header c3 email">Playback</th><th class="header c3 email">Stats</th>'),$("tbody").find("tr").get().forEach((function(tr){let td_user=$(tr).find("td").get()[0],userid=$(td_user).find("input[type='checkbox']").get()[0].value,cmid=parm.searchParams.get("id");const tableCell=document.createElement("td");function deactiveAll(){$(".active").removeClass("active")}tableCell.appendChild(analyticButton(userid)),$(tr).find("td").eq(3).after(tableCell);let args={id:userid,modulename:"assign",cmid:cmid},com=AJAX.call([{methodname:"cursive_user_list_submission_stats",args:args}]);try{com[0].done((function(json){var data=JSON.parse(json),filepath="";if(data.res.filename)filepath=data.res.filename;var score=parseFloat(data.res.score);data.res.first_file?"fa  fa fa-solid fa-info-circle typeid":score>=score_setting?"fa fa-check-circle typeid":score<score_setting?"fa fa-question-circle typeid":"fa fa-circle-o typeid";let textContent=document.querySelector(".page-header-headings h1").textContent,total_time_seconds=data.res.total_time_seconds,hours=Math.floor(total_time_seconds/3600).toString().padStart(2,"0"),minutes=Math.floor(total_time_seconds%3600/60).toString().padStart(2,"0"),seconds=(total_time_seconds%60).toString().padStart(2,"0"),formattedTime="".concat(hours,":").concat(minutes,":").concat(seconds);var context={tabledata:data.res,formattime:formattedTime,moduletitle:textContent,page:score_setting,userid:userid};$("#analytics"+userid).on("click",(function(e){e.preventDefault(),MyModal.create({templateContext:context}).then((modal=>{modal.show()})).catch((error=>{console.error("Failed to create modal:",error)}))})),$("body").on("click","#analytic"+userid,(function(e){e.preventDefault(),deactiveAll(),$(this).addClass("active"),templates.render("tiny_cursive/analytics_table",context).then((function(html){$("#content"+userid).html(html)})).fail((function(error){console.error("Failed to render template:",error)}))})),$("body").on("click","#diff"+userid,(function(e){e.preventDefault(),deactiveAll(),$(this).addClass("active"),$("#content"+userid).html("diff")})),$("body").on("click","#rep"+userid,(function(e){e.preventDefault(),deactiveAll(),$(this).addClass("active"),video_playback(userid,filepath)})),templates.render("tiny_cursive/pop_modal",context).then((function(html){$("body").append(html)})).catch((e=>window.console.error(e)))}))}catch(error){window.console.error(error)}return $(".popup_item").on("click",(function(){let mid=$(this).data("id");$("#"+mid).show()})),$(window).on("click",(function(e){e.target.id=="modal-close"+userid&&$("#"+userid).hide(),e.target.id=="modal-close-playback"+userid&&($("#playback"+userid).hide(),replayInstances[userid]&&replayInstances[userid].stopReplay())})),com.usercomment}))}};return usersTable}));

//# sourceMappingURL=append_submissions_table.min.js.map