{"version":3,"file":"append_participants_table.min.js","sources":["../src/append_participants_table.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     tiny_cursive/append_participants_table\n * @category TinyMCE Editor\n * @copyright  CTI <info@cursivetechnology.com>\n * @author kuldeep singh <mca.kuldeep.sekhon@gmail.com>\n */\n\ndefine([\"core/config\", \"core/str\"], function (mdlcfg, Str) {\n    var usersTable = {\n        init: async function (page) {\n            await usersTable.appendTable(page);\n        },\n        appendTable: async function () {\n            // $(document).ready(async function ($) {\n            // Get the first row in the table header\n\n            let h_tr = document.querySelector('thead tr');\n            const bodyElement = document.querySelector('body');\n            const bodyid = bodyElement.className;\n            let classes = bodyid.split(' ');\n\n            // Extract course ID\n            let courseid = parseInt(classes.find((classname) => {\n                return classname.startsWith('course-');\n            }).split('-')[1]);\n\n            // Fetch string for stats header\n            let statsString = await Str.get_string('stats', 'tiny_cursive');\n\n            // Add the stats header if it doesn't already exist\n            if (!h_tr.querySelector('#stats')) {\n                const sixthHeader = h_tr.querySelector('th:nth-child(7)'); // Adjust index if needed\n                const newHeader = document.createElement('th');\n                newHeader.className = 'header c7';\n                newHeader.setAttribute('scope', 'col');\n                newHeader.id = 'stats';\n                newHeader.textContent = statsString;\n                sixthHeader.after(newHeader);\n            }\n\n            // Iterate over each row in the table body\n            const tbody = document.querySelector('tbody');\n            const rows = tbody.querySelectorAll('tr');\n\n            rows.forEach((row) => {\n                const tdUser = row.querySelector('td');\n                const input = tdUser.querySelector('input');\n\n                if (input) {\n                    const userId = input.id.slice(4);\n\n                    if (userId) {\n                        const sixthTd = row.querySelector('td:last-child');\n\n                        // if (!sixthTd.querySelector('i:last-child')) {\n                        const color = 'font-size:24px;color:black;text-decoration:none';\n                        const link = mdlcfg.wwwroot + \"/lib/editor/tiny/plugins/cursive/writing_report.php?userid=\" + userId + \"&courseid=\" + courseid;\n                        const icon = 'fa fa-area-chart';\n\n                        const thunderIcon = document.createElement('td');\n                        const anchor = document.createElement('a');\n                        const iconElement = document.createElement('i');\n\n                        anchor.href = link;\n                        anchor.dataset.id = userId;\n                        iconElement.className = icon;\n                        iconElement.style = color;\n\n                        anchor.appendChild(iconElement);\n                        thunderIcon.appendChild(anchor);\n\n                        sixthTd.after(thunderIcon);\n                        // }\n                    }\n                }\n            });\n\n            // Add event listener for page change or other events triggering table update\n            const pageItems = document.querySelectorAll('.page-item, .header');\n\n            pageItems.forEach((element) => {\n                element.addEventListener('click', () => {\n                    setTimeout(() => {\n                        if (!document.querySelector('#stats')) {\n                            usersTable.init();\n                        }\n                    }, 1800);\n                });\n            });\n            // });\n        }\n    };\n    return usersTable;\n});\n"],"names":["define","mdlcfg","Str","usersTable","init","async","page","appendTable","h_tr","document","querySelector","classes","className","split","courseid","parseInt","find","classname","startsWith","statsString","get_string","sixthHeader","newHeader","createElement","setAttribute","id","textContent","after","querySelectorAll","forEach","row","input","userId","slice","sixthTd","color","link","wwwroot","icon","thunderIcon","anchor","iconElement","href","dataset","style","appendChild","element","addEventListener","setTimeout"],"mappings":"AAsBAA,gDAAO,CAAC,cAAe,aAAa,SAAUC,OAAQC,SAC9CC,WAAa,CACbC,KAAMC,eAAgBC,YACZH,WAAWI,YAAYD,OAEjCC,YAAaF,qBAILG,KAAOC,SAASC,cAAc,gBAG9BC,QAFgBF,SAASC,cAAc,QAChBE,UACNC,MAAM,KAGvBC,SAAWC,SAASJ,QAAQK,MAAMC,WAC3BA,UAAUC,WAAW,aAC7BL,MAAM,KAAK,IAGVM,kBAAoBjB,IAAIkB,WAAW,QAAS,oBAG3CZ,KAAKE,cAAc,UAAW,OACzBW,YAAcb,KAAKE,cAAc,mBACjCY,UAAYb,SAASc,cAAc,MACzCD,UAAUV,UAAY,YACtBU,UAAUE,aAAa,QAAS,OAChCF,UAAUG,GAAK,QACfH,UAAUI,YAAcP,YACxBE,YAAYM,MAAML,WAIRb,SAASC,cAAc,SAClBkB,iBAAiB,MAE/BC,SAASC,YAEJC,MADSD,IAAIpB,cAAc,MACZA,cAAc,YAE/BqB,MAAO,OACDC,OAASD,MAAMN,GAAGQ,MAAM,MAE1BD,OAAQ,OACFE,QAAUJ,IAAIpB,cAAc,iBAG5ByB,MAAQ,kDACRC,KAAOnC,OAAOoC,QAAU,8DAAgEL,OAAS,aAAelB,SAChHwB,KAAO,mBAEPC,YAAc9B,SAASc,cAAc,MACrCiB,OAAS/B,SAASc,cAAc,KAChCkB,YAAchC,SAASc,cAAc,KAE3CiB,OAAOE,KAAON,KACdI,OAAOG,QAAQlB,GAAKO,OACpBS,YAAY7B,UAAY0B,KACxBG,YAAYG,MAAQT,MAEpBK,OAAOK,YAAYJ,aACnBF,YAAYM,YAAYL,QAExBN,QAAQP,MAAMY,kBAOR9B,SAASmB,iBAAiB,uBAElCC,SAASiB,UACfA,QAAQC,iBAAiB,SAAS,KAC9BC,YAAW,KACFvC,SAASC,cAAc,WACxBP,WAAWC,SAEhB,qBAMZD"}