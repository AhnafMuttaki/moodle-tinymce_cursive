{"version":3,"file":"cursive_writing_reports.min.js","sources":["../src/cursive_writing_reports.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     tiny_cursive/cursive_writing_reports\n * @category TinyMCE Editor\n * @copyright  CTI <info@cursivetechnology.com>\n * @author kuldeep singh <mca.kuldeep.sekhon@gmail.com>\n */\n\ndefine([\"jquery\", \"core/ajax\", \"core/str\", \"core/templates\", \"./replay\", './analytic_button', \"./analytic_events\"], function (\n    $,\n    AJAX,\n    str,\n    templates,\n    Replay,\n    analyticButton,\n    customEvents\n) {\n    const replayInstances = {};\n    window.video_playback = function(mid, filepath) {\n        if (filepath !== '') {\n            // $(\"#playback\"+mid).show();\n            const replay = new Replay(\n                elementId = 'content' + mid,\n                filePath = filepath,\n                speed = 10,\n                loop = false,\n                controllerId = 'player_' + mid\n            );\n            replayInstances[mid] = replay;\n        }\n        else {\n            alert('No submission');\n        }\n        return false;\n\n    };\n    var usersTable = {\n        init: function (page) {\n            str\n                .get_strings([\n                    { key: \"field_require\", component: \"tiny_cursive\" },\n                ])\n                .done(function () {\n                    $(document).ready(function ($) {\n                            // $(\".popup_item\").on('click', function () {\n                            //     var mid = $(this).data(\"id\");\n                            //     $(\"#\" + mid).show();\n                            // });\n                        //     $(\".link_icon\").on('click', function () {\n                        //         var smid = $(this).data(\"id\");\n                        //         $(\"#\" + smid).show();\n\n                        //     });\n\n                        //     $(\".video_playback_icon\").on('click', function () {\n\n                        //         var mid = $(this).data(\"id\");\n                        //         var filepath = $(this).data(\"filepath\");\n                        //         if(filepath){\n                        //         $(\"#\" + mid).show();\n                        //         const replay = new Replay(\n                        //             elementId = 'output_'+mid,\n                        //             filePath = decodeURIComponent(filepath),\n                        //             speed = 10,\n                        //             loop = false,\n                        //             controllerId = 'player_' + mid\n                        //         );\n                        //         replayInstances[mid] = replay;\n                        //         } else {\n                        //             alert(\"File not found\");\n                        //         }\n                        //     });\n                        //     $(\".modal-close \").on('click', function () {\n                        //         $(\".modal\").hide();\n                        //         var mid = $(this).data(\"id\");\n                        //         if (replayInstances[mid]) {\n                        //             replayInstances[mid].stopReplay();\n                        //             delete replayInstances[mid];  // Clean up the instance\n                        //         }\n                        //     });\n                        let myEvents = new customEvents();\n                        $(\".analytic-modal\").each(function () {\n                           \n                            var mid = $(this).data(\"id\");\n                            var filepath = $(this).data(\"filepath\");\n                            let context = {userid:mid};\n                            let cmid = $(this).data(\"cmid\");\n                            \n                            $(this).html(analyticButton($(this).data('id')));\n                            $(this).on('click', function () {\n                                AJAX.call([{\n                                    methodname: 'cursive_get_writing_statistics',\n                                    args: {\n                                        cmid: cmid,\n                                        fileid: mid,\n                                    },\n                                }])[0].done(response=>{\n                                    \n                                    let data = JSON.parse(response.data);\n                                    context.formattime = usersTable.formatTime(data.total_time_seconds);\n                                    context.tabledata = data;\n                                }).fail(error =>  { throw new Error('Error: '+error.message); });\n                            });\n                            myEvents.createModal(mid, context);\n                            myEvents.analytics(mid, templates, context);\n                            myEvents.checkDiff(mid,mid);\n                            myEvents.replyWriting(mid, filepath);\n\n                        });\n\n\n                    });\n\n\n                    usersTable.getusers(page);\n                });\n        },\n\n        formatTime:function (totalSeconds) {\n            const hours = Math.floor(totalSeconds / 3600);\n            const minutes = Math.floor((totalSeconds % 3600) / 60);\n            const seconds = totalSeconds % 60;\n        \n            return `${hours}h ${minutes}m ${seconds}s`;\n        },\n        \n        getusers: function (page) {\n            $(\"#id_coursename\").change(function () {\n                var courseid = $(this).val();\n                var promise1 = AJAX.call([\n                    {\n                        methodname: \"cursive_get_user_list\",\n                        args: {\n                            courseid: courseid,\n                        },\n                    },\n                ]);\n                promise1[0].done(function (json) {\n                    var data = JSON.parse(json);\n                    var context = {\n                        tabledata: data,\n                        page: page,\n                    };\n                    templates\n                        .render(\"tiny_cursive/user_list\", context)\n                        .then(function (html) {\n\n                            var filtered_user = $(\"#id_username\");\n                            filtered_user.html(html);\n                        });\n                });\n\n                var promise2 = AJAX.call([\n                    {\n                        methodname: \"cursive_get_module_list\",\n                        args: {\n                            courseid: courseid,\n                        },\n                    },\n                ]);\n                promise2[0].done(function (json) {\n                    var data = JSON.parse(json);\n                    var context = {\n                        tabledata: data,\n                        page: page,\n                    };\n                    templates\n                        .render(\"tiny_cursive/module_list\", context)\n                        .then(function (html) {\n\n                            var filtered_user = $(\"#id_modulename\");\n                            filtered_user.html(html);\n                        });\n                });\n            });\n        },\n    };\n    return usersTable;\n});\n"],"names":["define","$","AJAX","str","templates","Replay","analyticButton","customEvents","replayInstances","window","video_playback","mid","filepath","replay","elementId","filePath","speed","loop","controllerId","alert","usersTable","init","page","get_strings","key","component","done","document","ready","myEvents","each","this","data","context","userid","cmid","html","on","call","methodname","args","fileid","response","JSON","parse","formattime","formatTime","total_time_seconds","tabledata","fail","error","Error","message","createModal","analytics","checkDiff","replyWriting","getusers","totalSeconds","hours","Math","floor","minutes","seconds","change","courseid","val","json","render","then"],"mappings":"AAsBAA,8CAAO,CAAC,SAAU,YAAa,WAAY,iBAAkB,WAAY,oBAAqB,sBAAsB,SAChHC,EACAC,KACAC,IACAC,UACAC,OACAC,eACAC,oBAEMC,gBAAkB,GACxBC,OAAOC,eAAiB,SAASC,IAAKC,aACjB,KAAbA,SAAiB,OAEXC,OAAS,IAAIR,OACfS,UAAY,UAAYH,IACxBI,SAAWH,SACXI,MAAQ,GACRC,MAAO,EACPC,aAAe,UAAYP,KAE/BH,gBAAgBG,KAAOE,YAGvBM,MAAM,wBAEH,OAGPC,WAAa,CACbC,KAAM,SAAUC,MACZnB,IACKoB,YAAY,CACT,CAAEC,IAAK,gBAAiBC,UAAW,kBAEtCC,MAAK,WACFzB,EAAE0B,UAAUC,OAAM,SAAU3B,OAqCpB4B,SAAW,IAAItB,aACnBN,EAAE,mBAAmB6B,MAAK,eAElBnB,IAAMV,EAAE8B,MAAMC,KAAK,MACnBpB,SAAWX,EAAE8B,MAAMC,KAAK,gBACxBC,QAAU,CAACC,OAAOvB,KAClBwB,KAAOlC,EAAE8B,MAAMC,KAAK,QAExB/B,EAAE8B,MAAMK,KAAK9B,eAAeL,EAAE8B,MAAMC,KAAK,QACzC/B,EAAE8B,MAAMM,GAAG,SAAS,WAChBnC,KAAKoC,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAM,CACFL,KAAMA,KACNM,OAAQ9B,QAEZ,GAAGe,MAAKgB,eAEJV,KAAOW,KAAKC,MAAMF,SAASV,MAC/BC,QAAQY,WAAazB,WAAW0B,WAAWd,KAAKe,oBAChDd,QAAQe,UAAYhB,QACrBiB,MAAKC,cAAkB,IAAIC,MAAM,UAAUD,MAAME,eAExDvB,SAASwB,YAAY1C,IAAKsB,SAC1BJ,SAASyB,UAAU3C,IAAKP,UAAW6B,SACnCJ,SAAS0B,UAAU5C,IAAIA,KACvBkB,SAAS2B,aAAa7C,IAAKC,gBAQnCQ,WAAWqC,SAASnC,UAIhCwB,WAAW,SAAUY,oBACXC,MAAQC,KAAKC,MAAMH,aAAe,MAClCI,QAAUF,KAAKC,MAAOH,aAAe,KAAQ,IAC7CK,QAAUL,aAAe,mBAErBC,mBAAUG,qBAAYC,cAGpCN,SAAU,SAAUnC,MAChBrB,EAAE,kBAAkB+D,QAAO,eACnBC,SAAWhE,EAAE8B,MAAMmC,MACRhE,KAAKoC,KAAK,CACrB,CACIC,WAAY,wBACZC,KAAM,CACFyB,SAAUA,aAIb,GAAGvC,MAAK,SAAUyC,UAEnBlC,QAAU,CACVe,UAFOL,KAAKC,MAAMuB,MAGlB7C,KAAMA,MAEVlB,UACKgE,OAAO,yBAA0BnC,SACjCoC,MAAK,SAAUjC,MAEQnC,EAAE,gBACRmC,KAAKA,YAIhBlC,KAAKoC,KAAK,CACrB,CACIC,WAAY,0BACZC,KAAM,CACFyB,SAAUA,aAIb,GAAGvC,MAAK,SAAUyC,UAEnBlC,QAAU,CACVe,UAFOL,KAAKC,MAAMuB,MAGlB7C,KAAMA,MAEVlB,UACKgE,OAAO,2BAA4BnC,SACnCoC,MAAK,SAAUjC,MAEQnC,EAAE,kBACRmC,KAAKA,wBAMpChB"}