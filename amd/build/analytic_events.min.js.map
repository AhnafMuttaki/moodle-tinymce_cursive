{"version":3,"file":"analytic_events.min.js","sources":["../src/analytic_events.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module analytic_events\n *\n * @module     tiny_cursive/analytic_events\n * @copyright  2024 YOUR NAME <your@email.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport MyModal from \"./analytic_modal\";\nimport { call as getContent } from \"core/ajax\";\nimport $ from 'jquery';\nexport default class AnalyticEvents {\n\n    createModal(userid, context, questionid = '', authIcon) {\n        $('#analytics' + userid + questionid).on('click', function (e) {\n            e.preventDefault();\n\n            // Create Moodle modal\n            MyModal.create({ templateContext: context }).then(modal => {\n                $('#content' + userid + ' .table tbody tr:first-child td:nth-child(2)').html(authIcon);\n                modal.show();\n            }).catch(error => {\n                console.error(\"Failed to create modal:\", error);\n            });\n        });\n    }\n\n    analytics(userid, templates, context, questionid = '', replayInstances = null, authIcon) {\n\n        $('body').on('click', '#analytic' + userid + questionid, function (e) {\n\n            e.preventDefault();\n            $('#content' + userid).html($('<div>').addClass('d-flex justify-content-center my-5').append($('<div>').addClass('tiny-cursive-loader')));\n            if (replayInstances && replayInstances[userid]) {\n                replayInstances[userid].stopReplay();\n            }\n            $('.active').removeClass('active');\n            $(this).addClass('active'); // Add 'active' class to the clicked element\n\n            templates.render('tiny_cursive/analytics_table', context).then(function (html) {\n                $('#content' + userid).html(html);\n                $('#content' + userid + ' .table tbody tr:first-child td:nth-child(2)').html(authIcon);\n\n            }).fail(function (error) {\n                console.error(\"Failed to render template:\", error);\n            });\n        });\n    }\n\n    checkDiff(userid, fileid, questionid = '', replayInstances = null) {\n        // Event handler for '#diff' + userid\n        const nodata = document.createElement('p');\n        nodata.classList.add('text-center', 'p-5', 'bg-light', 'rounded', 'm-5', 'text-primary');\n        nodata.style.verticalAlign = 'middle';\n        nodata.style.textTransform = 'uppercase';\n        nodata.style.fontWeight = '500';\n        nodata.textContent = \"no data received yet\";\n\n        $('body').on('click', '#diff' + userid + questionid, function (e) {\n         \n            e.preventDefault();\n            $('#content' + userid).html($('<div>').addClass('d-flex justify-content-center my-5').append($('<div>').addClass('tiny-cursive-loader')));\n            $('.active').removeClass('active');\n            if (replayInstances && replayInstances[userid]) {\n                replayInstances[userid].stopReplay();\n            }\n            $(this).addClass('active'); // Add 'active' class to the clicked element\n            if (!fileid) {\n                $('#content' + userid).html(nodata);\n                throw new Error('Missing file id or Difference Content not receive yet');\n            }\n            getContent([{\n                methodname: 'cursive_get_writing_differences',\n                args: {\n                    fileid: fileid,\n                },\n            }])[0].done(response => {\n                let responsedata = JSON.parse(response.data);\n                if (responsedata[0]) {\n\n                    let submitted_text = atob(responsedata[0].submitted_text);\n                    let reconstructed_text = responsedata[0].reconstructed_text;\n                    const $legend = $('<div class= \"d-flex p-2 border rounded  mb-2\">');\n\n                    // Create the first legend item\n                    const $attributedItem = $('<div>', { class: 'cursive-legend-item' });\n                    const $attributedBox = $('<div>', { class: 'cursive-box attributed' });\n                    const $attributedText = $('<span>').text('Attributed');\n                    $attributedItem.append($attributedBox).append($attributedText);\n\n                    // Create the second legend item\n                    const $unattributedItem = $('<div>', { class: 'cursive-legend-item' });\n                    const $unattributedBox = $('<div>', { class: 'cursive-box tiny_cursive_added' });\n                    const $unattributedText = $('<span>').text('Unattributed');\n                    $unattributedItem.append($unattributedBox).append($unattributedText);\n\n                    // Append the legend items to the legend container\n                    $legend.append($attributedItem).append($unattributedItem);\n\n                    let contents = $('<div>').addClass('cursive-comparison-content');\n\n                    let textBlock2 = $('<div>').addClass('cursive-text-block').append(\n                        $('<div>').attr('id', 'cursive-reconstructed_text').html(JSON.parse(submitted_text))\n                    );\n\n                    contents.append($legend, textBlock2);\n\n                    $('#content' + userid).html(contents); // Update content\n                } else {\n                    $('#content' + userid).html(nodata)\n                }\n\n            }).fail(error => { $('#content' + userid).html(nodata); throw new Error('Error loading JSON file: ' + error.message); });\n\n\n        });\n    }\n\n    replyWriting(userid, filepath, questionid = '', replayInstances = null) {\n        // Event handler for '#rep' + userid\n\n        $('body').on('click', '#rep' + userid + questionid, function (e) {\n            \n            e.preventDefault();\n            $('#content' + userid).html($('<div>').addClass('d-flex justify-content-center my-5').append($('<div>').addClass('tiny-cursive-loader')));\n            $('.active').removeClass('active');\n            $(this).addClass('active'); // Add 'active' class to the clicked element\n            if (replayInstances && replayInstances[userid]) {\n                replayInstances[userid].stopReplay();\n            }\n\n            if (filepath === '') {\n                $('#content' + userid).empty().append($('<p>')\n                    .text('No Submission')\n                    .addClass('text-center p-5 bg-light rounded m-5 text-primary')\n                    .css('vertical-align', 'middle')\n                    .css('text-transform', 'uppercase')\n                    .css('font-weight', '500'));\n            } else {\n                setTimeout(() => {\n                    video_playback(userid, filepath);\n                }, 3000);\n               \n\n            }\n        });\n    }\n\n    formatedTime(data) {\n        // Calculate and format total time\n        if (data.total_time_seconds) {\n            let total_time_seconds = data.total_time_seconds;\n            let hours = Math.floor(total_time_seconds / 3600).toString().padStart(2, 0);\n            let minutes = Math.floor((total_time_seconds % 3600) / 60).toString().padStart(2, 0);\n            let seconds = (total_time_seconds % 60).toString().padStart(2, 0);\n            let formattedTime = `${hours}h ${minutes}m ${seconds}s`;\n            return formattedTime\n        } else {\n            return \"0h 0m 0s\"\n        }\n    }\n\n    authorshipStatus(firstFile, score, score_setting) {\n\n        var score = parseFloat(score);\n        var icon = 'fa fa-circle-o';\n        var color = 'font-size:32px;color:black';\n\n        if (firstFile) {\n            icon = 'fa  fa fa-solid fa-info-circle';\n            color = 'font-size:32px;color:#000000';\n        } else {\n            if (score >= score_setting) {\n                icon = 'fa fa-check-circle';\n                color = 'font-size:32px;color:green';\n            } else if (score < score_setting) {\n                icon = 'fa fa-question-circle';\n                color = 'font-size:32px;color:#A9A9A9';\n            } else {\n                icon = 'fa fa-circle-o';\n                color = 'font-size:32px;color:black';\n            }\n        }\n        return $('<i>').addClass(icon).attr('style', color);\n    }\n\n}"],"names":["_interopRequireDefault","obj","__esModule","default","_analytic_modal","_jquery","_exports","createModal","userid","context","questionid","arguments","length","undefined","authIcon","$","on","e","preventDefault","MyModal","create","templateContext","then","modal","html","show","catch","error","console","analytics","templates","replayInstances","addClass","append","stopReplay","removeClass","this","render","fail","checkDiff","fileid","nodata","document","createElement","classList","add","style","verticalAlign","textTransform","fontWeight","textContent","Error","getContent","methodname","args","done","response","responsedata","JSON","parse","data","submitted_text","atob","reconstructed_text","$legend","$attributedItem","class","$attributedBox","$attributedText","text","$unattributedItem","$unattributedBox","$unattributedText","contents","textBlock2","attr","message","replyWriting","filepath","empty","css","setTimeout","video_playback","formatedTime","total_time_seconds","hours","Math","floor","toString","padStart","minutes","seconds","concat","authorshipStatus","firstFile","score","score_setting","parseFloat","icon","color"],"mappings":"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"}