define("tiny_cursive/autosaver",["exports","core/ajax","core/modal_factory","core/str","core/modal_events"],(function(_exports,_ajax,_modal_factory,_str,_modal_events){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.register=void 0;_exports.register=editor=>{const postOne=(methodname,args)=>(0,_ajax.call)([{methodname:methodname,args:args}])[0];document.addEventListener("DOMContentLoaded",(function(){var bodyElement=document.querySelector("#body");if(bodyElement)bodyElement.classList.contains("teacher_admin"),bodyElement.classList.contains("intervention");else console.error("#body element not found")}));const getModal=e=>(0,_modal_factory.create)({type:"SAVE_CANCEL",title:(0,_str.get_string)("tiny_cursive","tiny_cursive"),body:'<textarea class="form-control inputUrl" value="" id="inputUrl" placeholder="sourceurl"></textarea>',removeOnClose:!0}).done((modal=>{modal.getRoot().append("<style>.close { display: none !important; }</style>"),modal.show();var lastEvent="";return modal.getRoot().on(_modal_events.save,(function(){var number=document.getElementById("inputUrl").value;""===number||null==number?(editor.execCommand("Undo"),alert("You cannot paste text without providing source")):editor.execCommand("Paste");let ur=e.srcElement.baseURI,recourceId=0,parm=new URL(ur),modulename="",editorid=null==editor?void 0:editor.id,bodyClasses=document.body.className.split(" "),courseid=parseInt(bodyClasses.find((classname=>classname.startsWith("course-"))).split("-")[1]),cmid=parseInt(bodyClasses.find((classname=>classname.startsWith("cmid-"))).split("-")[1]);ur.includes("forum")||ur.includes("assign")||(recourceId=parm.searchParams.get("attempt")),recourceId=null===recourceId?0:recourceId,ur.includes("forum")?modulename="forum":ur.includes("assign")?modulename="assign":ur.includes("attempt")&&(modulename="quiz"),postOne("cursive_user_comments",{modulename:modulename,cmid:cmid||0,resourceid:recourceId,courseid:courseid,usercomment:number,timemodified:"1121232",editorid:editorid||""}),lastEvent="save",modal.destroy()})),modal.getRoot().on(_modal_events.cancel,(function(){editor.execCommand("Undo"),lastEvent="cancel"})),modal.getRoot().on(_modal_events.hidden,(function(){"cancel"!==lastEvent&&"save"!==lastEvent&&editor.execCommand("Undo")})),modal})),sendKeyEvent=(event,ed)=>{let ur=ed.srcElement.baseURI,parm=new URL(ur),recourceId=0,modulename="",editorid=null==editor?void 0:editor.id,bodyClasses=document.body.className.split(" "),cmid=parseInt(bodyClasses.find((classname=>classname.startsWith("cmid-"))).split("-")[1]);(ur.includes("attempt.php")||ur.includes("forum")||ur.includes("assign"))&&(ur.includes("forum")||ur.includes("assign")||(recourceId=parm.searchParams.get("attempt")),recourceId=null===recourceId?0:recourceId,ur.includes("forum")?modulename="forum":ur.includes("assign")?modulename="assign":ur.includes("attempt")&&(modulename="quiz"),postOne("cursive_json",{key:ed.key,event:event,keyCode:ed.keyCode,resourceId:recourceId,cmid:cmid,modulename:modulename,editorid:editorid||""}))};editor.on("keyUp",(editor=>{sendKeyEvent("keyUp",editor)})),editor.on("Paste",(async e=>{is_student&&intervention&&getModal(e)})),editor.on("Redo",(async e=>{is_student&&intervention&&getModal(e)})),editor.on("keyDown",(editor=>{sendKeyEvent("keyDown",editor)})),editor.on("init",(()=>{}))}}));

//# sourceMappingURL=autosaver.min.js.map