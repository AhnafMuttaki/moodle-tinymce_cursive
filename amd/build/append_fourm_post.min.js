define("tiny_cursive/append_fourm_post",["jquery","core/ajax","core/str","core/templates","./replay","./analytic_button","./analytic_events"],(function($,AJAX,str,templates,Replay,analyticButton,AnalyticEvents){const replayInstances={};window.myFunction=function(){let mid=$(this).data("id");$("#typeid"+mid).show()},window.video_playback=function(mid,filepath){if(""!==filepath){const replay=new Replay(elementId="content"+mid,filePath=filepath,speed=10,loop=!1,controllerId="player_"+mid);replayInstances[mid]=replay}else alert("No submission");return!1},window.popup_item=function(mid){$("#"+mid).show()};const repliesContainer=document.querySelector('div[data-region="replies-container"]'),replies=Array.from(repliesContainer.children).filter((child=>"replies-container"!==child.dataset.region)).map((child=>child.cloneNode(!0)));repliesContainer.innerHTML="";const existingElementsWrapper=document.createElement("div");existingElementsWrapper.className="col-12",existingElementsWrapper.id="existingElementsWrapper",existingElementsWrapper.dataset.region="post",replies.forEach((reply=>existingElementsWrapper.appendChild(reply)));const references=document.createElement("div");references.id="source-urls",references.className="col-3 p-0 bg-light rounded shadow-sm d-none",repliesContainer.classList.add("row"),repliesContainer.appendChild(existingElementsWrapper),repliesContainer.appendChild(references);var usersTable={init:function(score_setting,showcomment){str.get_strings([{key:"field_require",component:"tiny_cursive"}]).done((function(){usersTable.getToken(score_setting,showcomment)}))},getToken:function(score_setting,showcomment){$("#page-mod-forum-discuss").find("article").get().forEach((function(entry){$(document).ready((function(){var replyButton=$('a[data-region="post-action"][title="Reply"]');replyButton.length>0&&replyButton.on("click",(function(event){event.preventDefault();var url=$(this).attr("href");window.location.href=url}))}));var ids=$("#"+entry.id).data("post-id"),anchorTag=$('a.nav-link.active.active_tree_node[href*="mod/forum/view.php?id="]'),cmid=0;anchorTag.length>0&&(cmid=anchorTag.attr("href").match(/id=(\d+)/)[1]);let args={id:ids,modulename:"forum",cmid:cmid},com=AJAX.call([{methodname:"cursive_get_forum_comment_link",args:args}]);return com[0].done((function(json){var data=JSON.parse(json),filepath="";if(data.data.filename)filepath=data.data.filename;if(filepath){var score=parseFloat(data.data.score);data.data.first_file?("fa  fa fa-solid fa-info-circle typeid","font-size:24px;color:#000000"):score>=score_setting?("fa fa-check-circle typeid","font-size:24px;color:green"):score<score_setting?("fa fa-question-circle typeid","font-size:24px;color:#A9A9A9"):("fa fa-circle-o typeid","font-size:24px;color:black");let analytic_button_div=document.createElement("div");if(analytic_button_div.append(analyticButton(ids)),analytic_button_div.classList.add("text-center","mt-2"),analytic_button_div.dataset.region="analytic-div"+ids,$("#"+entry.id).find("#post-content-"+ids).append(analytic_button_div),"comments"!=data.usercomment&&parseInt(showcomment)){let analyticdiv=$('div[data-region="analytic-div'+ids+'"]');data.usercomment.forEach((element=>{let refBtn=$("<a>").attr("href","#").addClass("cursive-analytics-btn text-white p-2 mx-2").attr("id","ref"+ids),refSpan=$("<span>").text("References");refBtn.append(refSpan),analyticdiv.append(refBtn),refBtn.on("click",(function(event){event.preventDefault(),$("#existingElementsWrapper").removeClass("col-12").addClass("col-9"),$("#source-urls").removeClass("d-none").html('<div class="border-bottom p-3 text-primary" style="font-weight:600;">'+element.usercomment+"</div>"),$("#source-urls").append("<a href='#' id='ref-tab-close"+ids+"' class='btn btn-outline-light d-block btn-sm'>Close this tab</a>")})),$("#source-urls").on("click","#ref-tab-close"+ids,(function(e){e.preventDefault(),$("#existingElementsWrapper").removeClass("col-9").addClass("col-12"),$("#source-urls").addClass("d-none").html("")}))}))}let myEvents=new AnalyticEvents;var context={tabledata:data.data,formattime:myEvents.formatedTime(data.data),page:score_setting,userid:ids};myEvents.createModal(ids,context),myEvents.analytics(ids,templates,context,"",replayInstances),myEvents.checkDiff(ids,data.data.file_id,"",replayInstances),myEvents.replyWriting(ids,filepath,"",replayInstances),templates.render("tiny_cursive/pop_modal",context).then((function(html){$("body").append(html)})).catch((e=>window.console.error(e)))}})),$(window).on("click",(function(e){e.target.id=="modal-close"+ids&&$("#"+ids).hide(),e.target.id=="modal-close-playback"+ids&&($("#playback"+ids).hide(),replayInstances[ids]&&replayInstances[ids].stopReplay())})),com.usercomment})),$("#page-mod-forum-view").find("article").get().forEach((function(entry){var ids=$("#"+entry.id).data("post-id"),cmid=0,anchorTag=$('a.nav-link.active.active_tree_node[href*="mod/forum/view.php?id="]');if(anchorTag.length>0){var hrefValue=anchorTag.attr("href");cmid=parseInt(hrefValue.match(/id=(\d+)/)[1])}let args={id:ids,modulename:"forum",cmid:cmid},com=AJAX.call([{methodname:"cursive_get_comment_link",args:args}]);return com[0].done((function(json){var data=JSON.parse(json);$("#"+entry.id).find("#post-content-"+ids).append('<div class="border alert alert-warning"><summary>Content Sources Provided by Student</summary> <p>'+data.usercomment+ids+"</p></div>")})),com.usercomment}))}};return usersTable}));

//# sourceMappingURL=append_fourm_post.min.js.map